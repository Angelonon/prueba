name: Brick Breaker with Flame
steps:
  - name: step_03
    steps:
      - name: Remove generated code
        rmdir: step_03
      - name: Create project
        flutter: create brick_breaker --empty
      - name: Configure analysis_options.yaml
        path: brick_breaker/analysis_options.yaml
        replace-contents: |
          include: ../../analysis_options.yaml

          linter:
            rules:
              avoid_print: false
      - name: Add dependencies
        path: brick_breaker
        flutter: pub add flame flutter_animate google_fonts
      - name: Remove README
        rm: brick_breaker/README.md
      - name: Add .vscode directory
        mkdir: brick_breaker/.vscode
      - name: Add .vscode/launch.json
        path: brick_breaker/.vscode/launch.json
        replace-contents: |
          {
              // Use IntelliSense to learn about possible attributes.
              // Hover to view descriptions of existing attributes.
              // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
              "version": "0.2.0",
              "configurations": [
                  {
                      "name": "brick_breaker",
                      "request": "launch",
                      "type": "dart"
                  }
              ]
          }
      - name: Replace lib/main.dart
        path: brick_breaker/lib/main.dart
        replace-contents: |
          import 'package:flame/game.dart';
          import 'package:flutter/widgets.dart';

          void main() {
            final game = FlameGame();
            runApp(GameWidget(game: game));
          }
      - name: Build iOS simulator bundle
        platforms: [ macos ]
        path: brick_breaker
        flutter: build ios --simulator
      - name: Build macOS app
        platforms: [ macos ]
        path: brick_breaker
        flutter: build macos
      - name: Build Linux app
        platforms: [ linux ]
        path: brick_breaker
        flutter: build linux
      - name: Build Windows app
        platforms: [ windows ]
        path: brick_breaker
        flutter: build windows
      - name: Copy step_03
        copydir:
          from: brick_breaker
          to: step_03
      - name: Flutter clean
        path: step_03
        flutter: clean
  - name: Cleanup
    rmdir: brick_breaker