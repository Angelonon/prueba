name: Diving in to Dart 3
steps:

  # Step 1
  - name: step_01
    steps:
      - name: Remove generated code
        rmdir: step_01
      - name: Create project
        flutter: create --empty patterns_codelab
      - name: Strip DEVELOPMENT_TEAM
        strip-lines-containing: DEVELOPMENT_TEAM =
        path: patterns_codelab/ios/Runner.xcodeproj/project.pbxproj
      - name: Remove README
        rm: patterns_codelab/README.md
      - name: Replace lib/main.dart
        path: patterns_codelab/lib/main.dart
        replace-contents: |
          // Copyright 2023 The Flutter Authors. All rights reserved.
          // Use of this source code is governed by a BSD-style license that can be
          // found in the LICENSE file.

          import 'package:flutter/material.dart';

          void main() {
            runApp(const MainApp());
          }

          class MainApp extends StatelessWidget {
            const MainApp({super.key});

            @override
            Widget build(BuildContext context) {
              return const MaterialApp(
                home: Scaffold(
                  body: Center(
                    child: Text('Hello World!'),
                  ),
                ),
              );
            }
          }
      - name: Update pubspec.yaml
        path: patterns_codelab/pubspec.yaml
        replace-contents: |
          name: patterns_codelab
          description: A new Flutter project.
          publish_to: 'none'
          version: 1.0.0
          environment:
            sdk: '>=3.0.0-0 <4.0.0'
          dependencies:
            flutter:
              sdk: flutter
            cupertino_icons: ^1.0.2
          dev_dependencies:
            flutter_test:
              sdk: flutter
            flutter_lints: ^2.0.0
          flutter:
            uses-material-design: true
            assets:
              - assets/data.json
      - name: Create assets/data.json
        mkdir: patterns_codelab/assets/
      - name: Add assets/data.json
        path: patterns_codelab/assets/data.json
        replace-contents: |
          {
            "issues": [
              {
                "title": "Test Issue"
              }
            ]
          }
      - name: Build iOS simulator bundle
        platforms: [ macos ]
        path: patterns_codelab
        flutter: build ios --simulator
      - name: Build macOS app
        platforms: [ macos ]
        path: patterns_codelab
        flutter: build macos
      - name: Build Linux app
        platforms: [ linux ]
        path: patterns_codelab
        flutter: build linux
      - name: Build Windows app
        platforms: [ windows ]
        path: patterns_codelab
        flutter: build windows
      - name: Copy step_01
        copydir:
          from: patterns_codelab
          to: step_01
      - name: Flutter clean
        path: patterns_codelab
        flutter: clean

  # Cleanup
  - name: Cleanup
    rmdir: patterns_codelab
